var orm = require("../lib/ORM");

// orm.connect("redshift://dresende@localhost:/orm_test", function (err, db) {
orm.connect("mysql://root:tedua@localhost/orm?pool=true", function (err, db) {
// orm.connect("mongodb:///test", function (err, db) {
// orm.connect("sqlite://", function (err, db) {
	if (err) {
		console.log("ERROR");
		throw err;
	}

	db.load(__dirname + "/test-model-person", function (err) {
		if (err) {
			console.log("LOAD ERROR", err);
			throw err;
		}

		var Person = db.models.person;
		var Pet    = db.models.pet;

		db.sync(function () {
			var Deco = new Pet({
				name    : "Deco"
			});
			var John = new Person({
				name    : "John",
				surname : "Doe",
				male    : true
			});
			John.setPets(Deco, function (err) {
				console.log("error", err);

				John.getPets(function (err, pets) {
					console.log("pets", pets);

					setTimeout(function () {
						John.removePets(function (err) {
							console.log("error", err);
							process.exit(1);
						});
					}, 10000);
				});
			});
		});
	});
});
